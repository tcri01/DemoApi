@model DemoApi.Models.Member

<div class="row g-3">
    <div class="col-md-12">
        <label asp-for="Company" class="form-label">公司名稱</label>
        <input asp-for="Company" id="formCompanyName" class="form-control" placeholder="請輸入公司名稱" />
        <span asp-validation-for="Company" class="text-danger"></span>
    </div>
    <div class="col-md-6">
        <label asp-for="Name" class="form-label">聯絡人姓名</label>
        <input asp-for="Name" id="formContactName" class="form-control" placeholder="請輸入姓名" required />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>
    <div class="col-md-6">
        <label asp-for="Email" class="form-label">E-mail</label>
        <input asp-for="Email" class="form-control" placeholder="example@mail.com" required />
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>
    <div class="col-md-6">
        <label asp-for="Phone" class="form-label">電話</label>
        <input asp-for="Phone" class="form-control" placeholder="02-12345678" />
        <span asp-validation-for="Phone" class="text-danger"></span>
    </div>
    <div class="col-md-6">
        <label asp-for="Mobile" class="form-label">行動電話</label>
        <input asp-for="Mobile" class="form-control" placeholder="0912-345678" required />
        <span asp-validation-for="Mobile" class="text-danger"></span>
    </div>
    
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-1">
            <label asp-for="Content" class="form-label">問題或建議</label>
            <div class="btn-group">
                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="completeContent(this)">
                    <i class="bi bi-magic"></i> AI 補全
                </button>
                <button type="button" class="btn btn-sm btn-outline-secondary" onclick="suggestContent(this)">
                    <i class="bi bi-lightbulb"></i> AI 建議
                </button>
            </div>
        </div>
        <textarea asp-for="Content" id="formMessageContent" class="form-control" rows="5" placeholder="請輸入您的問題或建議..."></textarea>
        <span asp-validation-for="Content" class="text-danger"></span>
    </div>
</div>

<script>
    async function suggestContent(btn) {
        const row = btn.closest('form');
        const name = row.querySelector('#formContactName').value;
        const company = row.querySelector('#formCompanyName').value;
        const target = row.querySelector('#formMessageContent');
        
        const originalContent = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';

        try {
            const response = await fetch(`/Members/Create?handler=SuggestContent&name=${encodeURIComponent(name)}&company=${encodeURIComponent(company)}`);
            const data = await response.json();
            if (data.success) {
                target.value = data.suggestion;
            }
        } finally {
            btn.disabled = false;
            btn.innerHTML = originalContent;
        }
    }

    async function completeContent(btn) {
        const row = btn.closest('form');
        const currentText = row.querySelector('#formMessageContent').value;
        const target = row.querySelector('#formMessageContent');
        
        const originalContent = btn.innerHTML;
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm"></span>';

        try {
            const response = await fetch(`/Members/Create?handler=CompleteContent&currentText=${encodeURIComponent(currentText)}`);
            const data = await response.json();
            if (data.success) {
                target.value = data.completed;
            }
        } finally {
            btn.disabled = false;
            btn.innerHTML = originalContent;
        }
    }
</script>
